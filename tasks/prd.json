{
  "project": "Figma Sentinel",
  "branchName": "ralph/figma-sentinel-package",
  "description": "Extract Figma Sentinel into a standalone npm package and GitHub Action with CLI, core library, and automated PR creation for design change tracking",
  "sourceRepo": "/Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel",
  "npmScope": "@khoavhd",
  "license": "MIT",
  "userStories": [
    {
      "id": "US-001",
      "title": "Initialize monorepo with pnpm workspaces",
      "description": "As a maintainer, I want a monorepo structure so that packages can share code efficiently.",
      "acceptanceCriteria": [
        "Create root package.json with name 'figma-sentinel-monorepo' and private: true",
        "Create pnpm-workspace.yaml with packages: ['packages/*']",
        "Create packages/core, packages/cli, packages/action directories",
        "Each package has its own package.json with scope @khoavhd (@khoavhd/figma-sentinel-core, @khoavhd/figma-sentinel, @khoavhd/figma-sentinel-action)",
        "Add root scripts: build, test, lint, typecheck",
        "Add MIT LICENSE file at root",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Configure shared TypeScript and ESLint",
      "description": "As a maintainer, I want shared tooling config so that code quality is consistent across packages.",
      "acceptanceCriteria": [
        "Create root tsconfig.json with strict mode and project references",
        "Create packages/core/tsconfig.json extending root config",
        "Create packages/cli/tsconfig.json extending root config",
        "Create packages/action/tsconfig.json extending root config",
        "Create root .eslintrc.js with TypeScript rules",
        "Create root .prettierrc with consistent formatting",
        "Add .gitignore for node_modules, dist, .turbo",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create core package with types",
      "description": "As a developer, I want TypeScript types exported so that I get type safety when using the library.",
      "acceptanceCriteria": [
        "Clone types.ts from /Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel/types.ts to packages/core/src/types.ts",
        "Export FigmaDirective, FigmaNode, NormalizedSpec, ChangelogEntry, SentinelConfig types",
        "Create packages/core/src/index.ts that re-exports all types",
        "Add zod and fast-glob as dependencies in packages/core/package.json",
        "Configure package.json exports for ESM and CommonJS",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Migrate normalizer module to core",
      "description": "As a developer, I want the normalizer module so that Figma nodes can be normalized consistently.",
      "acceptanceCriteria": [
        "Clone normalizer.ts from /Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel/normalizer.ts to packages/core/src/normalizer.ts",
        "Update imports to use local types",
        "Export normalizeNode, toStableJson, createNormalizer from index.ts",
        "Clone and adapt tests from source __tests__/normalizer.test.ts to packages/core/src/__tests__/normalizer.test.ts",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Migrate parser module to core",
      "description": "As a developer, I want the parser module so that Figma directives can be extracted from source files.",
      "acceptanceCriteria": [
        "Clone parser.ts from /Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel/parser.ts to packages/core/src/parser.ts",
        "Update imports to use local types and fast-glob",
        "Export parseFile, parseDirectives, parseDirectivesSync from index.ts",
        "Clone and adapt tests from source __tests__/parser.test.ts to packages/core/src/__tests__/parser.test.ts",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Migrate figma-client module to core",
      "description": "As a developer, I want the Figma API client so that nodes can be fetched from Figma.",
      "acceptanceCriteria": [
        "Clone figma-client.ts from /Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel/figma-client.ts to packages/core/src/figma-client.ts",
        "Update imports to use local types",
        "Use native fetch (Node 18+) instead of any external HTTP library",
        "Export fetchNodes, FetchedNode, FetchResult, FetchError from index.ts",
        "Clone and adapt tests from source __tests__/figma-client.test.ts to packages/core/src/__tests__/figma-client.test.ts",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Migrate storage module to core",
      "description": "As a developer, I want the storage module so that specs can be persisted and changes detected.",
      "acceptanceCriteria": [
        "Clone storage.ts from /Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel/storage.ts to packages/core/src/storage.ts",
        "Update imports to use local types and normalizer",
        "Export createNormalizedSpec, saveSpec, loadSpec, loadAllSpecs, detectChanges from index.ts",
        "Add unit tests in packages/core/src/__tests__/storage.test.ts",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Migrate differ module to core",
      "description": "As a developer, I want the differ module so that changelogs can be generated.",
      "acceptanceCriteria": [
        "Clone differ.ts from /Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel/differ.ts to packages/core/src/differ.ts",
        "Update imports to use local types and storage",
        "Export generateChangelogEntries, generateChangelogMarkdown, generatePRBody from index.ts",
        "Clone and adapt tests from source __tests__/differ.test.ts to packages/core/src/__tests__/differ.test.ts",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Migrate image-exporter module to core",
      "description": "As a developer, I want the image exporter so that node images can be exported from Figma.",
      "acceptanceCriteria": [
        "Clone image-exporter.ts from /Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel/image-exporter.ts to packages/core/src/image-exporter.ts",
        "Update imports to use local types",
        "Export exportImages, exportImagesForMultipleFiles, cleanupRemovedImages from index.ts",
        "Clone and adapt tests from source __tests__/image-exporter.test.ts to packages/core/src/__tests__/image-exporter.test.ts",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Migrate markdown-exporter module to core",
      "description": "As a developer, I want the markdown exporter so that LLM-optimized specs can be generated.",
      "acceptanceCriteria": [
        "Clone markdown-exporter.ts from /Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel/markdown-exporter.ts to packages/core/src/markdown-exporter.ts",
        "Update imports to use local types",
        "Export exportSpecsAsMarkdown, generateMarkdownFromSpec from index.ts",
        "Add unit tests in packages/core/src/__tests__/markdown-exporter.test.ts",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Create runSentinel orchestrator in core",
      "description": "As a developer, I want a main entry point so that the full workflow can be executed programmatically.",
      "acceptanceCriteria": [
        "Clone and refactor index.ts from /Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel/index.ts to packages/core/src/sentinel.ts",
        "Keep only runSentinel function and SentinelResult/SentinelOptions types",
        "Remove CLI main() function (that goes in CLI package)",
        "Export runSentinel and SentinelResult from index.ts",
        "Clone and adapt tests from source __tests__/index.test.ts to packages/core/src/__tests__/sentinel.test.ts",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Migrate config module and add Zod validation",
      "description": "As a developer, I want config validation so that invalid configurations fail with clear errors.",
      "acceptanceCriteria": [
        "Clone config.ts from /Users/macbook/Documents/repos/Relia/playaz4playaz/playaz4playaz-mobile/scripts/figma-sentinel/config.ts to packages/core/src/config.ts",
        "Replace manual validation with Zod schema for SentinelConfig",
        "Keep DEFAULT_CONFIG, mergeConfig, createDefaultConfigFile functions",
        "Export validateConfig, loadConfig, DEFAULT_CONFIG from index.ts",
        "Add unit tests for valid and invalid configs",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Create CLI package structure",
      "description": "As a developer, I want a CLI package so that I can run figma-sentinel from the command line.",
      "acceptanceCriteria": [
        "Create packages/cli/package.json with bin entry pointing to dist/index.js",
        "Add dependencies: commander, prompts, ora, kleur, cosmiconfig, fs-extra, execa",
        "Add @aspect-build/figma-sentinel-core as workspace dependency",
        "Create packages/cli/src/index.ts with shebang and basic commander setup",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Implement CLI sync command",
      "description": "As a developer, I want to run 'figma-sentinel sync' to detect and sync design changes.",
      "acceptanceCriteria": [
        "Create packages/cli/src/commands/sync.ts",
        "Use ora spinner for 'Scanning for directives...', 'Fetching from Figma...', 'Detecting changes...'",
        "Use kleur for colorized success/error/warning messages",
        "Support --dry-run, --cwd, --config flags",
        "Exit 0 on success, 1 on error",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Implement CLI check command",
      "description": "As a developer, I want to run 'figma-sentinel check' to validate my setup without making changes.",
      "acceptanceCriteria": [
        "Create packages/cli/src/commands/check.ts",
        "Check for config file existence and validity",
        "Check for FIGMA_TOKEN environment variable",
        "Parse directives and report count without fetching from Figma",
        "Display summary: X files with directives, Y total nodes",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Implement CLI diff command for debugging",
      "description": "As a developer, I want to run 'figma-sentinel diff <node-id>' to debug specific node changes.",
      "acceptanceCriteria": [
        "Create packages/cli/src/commands/diff.ts",
        "Accept node-id as positional argument",
        "Fetch current node from Figma API",
        "Load existing spec from .design-specs if exists",
        "Display side-by-side diff of properties",
        "Highlight added, changed, removed properties with colors",
        "Support --file-key flag to specify Figma file",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-017",
      "title": "Implement CLI init command with prompts",
      "description": "As a developer, I want to run 'figma-sentinel init' to interactively set up my project.",
      "acceptanceCriteria": [
        "Create packages/cli/src/commands/init.ts",
        "Use prompts for: config format (js/json/package.json), specs directory, file patterns",
        "Generate config file based on user selection",
        "Add example directives comment to show in output",
        "Display next steps after creation",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-018",
      "title": "Implement cosmiconfig loader in CLI",
      "description": "As a developer, I want flexible config loading so that I can use my preferred config format.",
      "acceptanceCriteria": [
        "Create packages/cli/src/config.ts using cosmiconfig with moduleName 'figma-sentinel'",
        "Support: figma-sentinel.config.js, .figma-sentinelrc.json, package.json key",
        "Merge loaded config with defaults from core",
        "Cache config for performance within single run",
        "Validate with Zod schema from core",
        "Typecheck passes"
      ],
      "priority": 18,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-019",
      "title": "Create GitHub Action structure",
      "description": "As a DevOps engineer, I want a GitHub Action so that design sync runs automatically in CI.",
      "acceptanceCriteria": [
        "Create packages/action/action.yml with name, description, branding",
        "Define inputs: figma-token (required), config-path, dry-run, create-pr, pr-title, pr-labels",
        "Define outputs: has-changes, changelog-path, pr-number, pr-url",
        "Add dependencies: @actions/core, @actions/github, @actions/exec",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-020",
      "title": "Implement GitHub Action main script",
      "description": "As a DevOps engineer, I want the action to run sentinel and report results.",
      "acceptanceCriteria": [
        "Create packages/action/src/index.ts with @actions/core getInput/setOutput",
        "Set FIGMA_TOKEN from input to environment",
        "Call runSentinel from core package",
        "Set outputs: has-changes, changelog-path",
        "Use core.setFailed on errors",
        "Typecheck passes"
      ],
      "priority": 20,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-021",
      "title": "Implement PR creation in GitHub Action",
      "description": "As a DevOps engineer, I want the action to create PRs when changes are detected.",
      "acceptanceCriteria": [
        "Create packages/action/src/pr.ts with createOrUpdatePR function",
        "Use @actions/github Octokit to create PR",
        "Read PR body from generated PR_BODY.md",
        "Support configurable title, labels, reviewers from inputs",
        "Check if PR already exists for branch and update instead of create",
        "Set pr-number and pr-url outputs",
        "Typecheck passes"
      ],
      "priority": 21,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-022",
      "title": "Add CI workflow for testing",
      "description": "As a maintainer, I want CI tests so that PRs are validated automatically.",
      "acceptanceCriteria": [
        "Create .github/workflows/ci.yml",
        "Run on push to main and pull_request",
        "Steps: checkout, setup pnpm, install, build, lint, typecheck, test",
        "Use matrix for Node 18 and Node 20",
        "Typecheck passes"
      ],
      "priority": 22,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-023",
      "title": "Add release workflow with changesets",
      "description": "As a maintainer, I want automated releases so that publishing is consistent.",
      "acceptanceCriteria": [
        "Add @changesets/cli as dev dependency",
        "Create .changeset/config.json with access: public",
        "Create .github/workflows/release.yml for automated npm publishing",
        "Trigger on push to main when changesets are merged",
        "Publish packages with provenance",
        "Typecheck passes"
      ],
      "priority": 23,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-024",
      "title": "Create README with quick start guide",
      "description": "As a new user, I want documentation so that I can set up Figma Sentinel quickly.",
      "acceptanceCriteria": [
        "Create root README.md with project overview",
        "Add Installation section for npm and GitHub Action",
        "Add Quick Start with example directive syntax",
        "Add Configuration section with all options",
        "Add CLI Commands section (sync, check, init, diff)",
        "Add GitHub Action Usage section with example workflow",
        "Typecheck passes"
      ],
      "priority": 24,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-025",
      "title": "Add example workflow files",
      "description": "As a new user, I want example workflows so that I can copy and customize.",
      "acceptanceCriteria": [
        "Create examples/workflows/scheduled-sync.yml for cron-based sync",
        "Create examples/workflows/on-push-sync.yml for push-triggered sync",
        "Create examples/workflows/manual-sync.yml for workflow_dispatch",
        "Include comments explaining each section",
        "Typecheck passes"
      ],
      "priority": 25,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-026",
      "title": "Add CONTRIBUTING and LICENSE",
      "description": "As a contributor, I want contribution guidelines so that I know how to contribute.",
      "acceptanceCriteria": [
        "Create CONTRIBUTING.md with development setup, testing, PR process",
        "LICENSE already created in US-001 with MIT license",
        "Create CHANGELOG.md with initial v1.0.0 entry placeholder",
        "Add .npmrc for pnpm configuration",
        "Typecheck passes"
      ],
      "priority": 26,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-027",
      "title": "Add Figma Variables API support (future enhancement)",
      "description": "As a developer, I want to track Figma Variables changes so that design token updates are detected.",
      "acceptanceCriteria": [
        "Create packages/core/src/variables-client.ts for Variables REST API",
        "Add fetchVariables function to get variable collections and modes",
        "Add normalizeVariables function to create comparable specs",
        "Add detectVariableChanges function for change detection",
        "Add 'variables' directive support: @figma-variables: <collection-name>",
        "Export variables functions from core index.ts",
        "Add CLI 'figma-sentinel variables' command",
        "Document Variables API usage in README",
        "Typecheck passes"
      ],
      "priority": 27,
      "passes": false,
      "notes": "Future enhancement - requires Figma Enterprise for full Variables API access"
    }
  ]
}
